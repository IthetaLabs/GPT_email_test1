<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Copy Window (Rich)</title>
<style>
  :root{--card:#fff;--border:#e5e7eb;--ink:#111827}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fafafa;margin:0;padding:24px;color:var(--ink)}
  .wrap{max-width:820px;margin:0 auto;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px}
  h1{margin:0 0 12px 0;font-size:22px}
  .bar{margin:14px 0 16px 0;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button{padding:10px 14px;border:1px solid #d1d5db;border-radius:10px;background:#fff;cursor:pointer}
  .ok{color:#16a34a}
  .hint{font-size:12px;color:#6b7280;margin:10px 0 0 0}
  /* The content block the user will copy */
  /* ---- Outlook-friendly preview styles ---- */
  #cp-html{
    border:1px solid #d1d5db;border-radius:12px;padding:16px;background:#fff;
    font-family: Arial, Helvetica, sans-serif; /* font */
    font-size: 11pt;                          /* size */
    line-height: 1.5;                          /* spacing */
  }
  #cp-html p{ margin:0 0 10px 0 }
  #cp-html h1,#cp-html h2,#cp-html h3{ margin:16px 0 8px 0 }
  #cp-html ul,#cp-html ol{ margin:0 0 12px 20px }
  #cp-html li{ margin:6px 0 }
  /* optional: enforce typography on all children in the preview */
  /* #cp-html * { font-family: Arial, Helvetica, sans-serif; font-size: 11pt; line-height: 1.5; }
  }
  /* Reasonable default spacing for pasted paragraphs/lists */
  #cp-html p{margin:0 0 10px 0}
  #cp-html h1,#cp-html h2,#cp-html h3{margin:16px 0 8px 0}
  #cp-html ul,#cp-html ol{margin:0 0 12px 20px}
  #cp-html li{margin:6px 0}
</style>
</head>
<body>
<div class="wrap">
  <h1>Copy Window</h1>
  <p>This shows your email exactly as you’ll paste it into Outlook — with <b>bold</b>, bullets, emojis, spacing and font intact.</p>

  <div class="bar">
    <button id="copyRich" type="button">Copy (Rich HTML)</button>
    <button id="copyPlain" type="button">Copy (Plain Text)</button>
    <span id="cp-status" aria-live="polite" class="ok"></span>
  </div>

  <!-- contenteditable so the browser copies HTML when selected -->
  <div id="cp-html" contenteditable="true">
    <p><em>Waiting for content…</em></p>
  </div>

  <p class="hint">Tip: If a link didn’t load content, paste your email HTML here and click “Copy (Rich HTML)”.</p>
</div>

<script>
(function(){
  const box = document.getElementById('cp-html');
  const status = document.getElementById('cp-status');

  function fromQuery(name){ return new URLSearchParams(location.search).get(name); }
  function fromHash(name){
    const h = location.hash.startsWith('#') ? location.hash.slice(1) : location.hash;
    if(!h) return null;
    const parts = h.split('&').reduce((acc, kv) => {
      const i = kv.indexOf('=');
      if (i === -1) return acc;
      acc[kv.slice(0,i)] = kv.slice(i+1);
      return acc;
    }, {});
    return parts[name] || null;
  }
  function safeDecode(s){ try { return decodeURIComponent(s); } catch(e){ return s; } }
  function b64UrlToText(s){
    try {
      s = (s||'').replace(/-/g, '+').replace(/_/g, '/');
      while (s.length % 4 !== 0) s += '=';
      return atob(s);
    } catch(e){ return null; }
  }
  function setHTML(html){
    // Basic safety: allow expected email tags; you can add a sanitizer if you like.
    box.innerHTML = html;
  }
  function setTextAsHtml(plain){
    // Convert plain text with newlines into paragraphs for a nicer default
    const escaped = plain
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    const html = escaped.split(/\n{2,}/).map(p => `<p>${p.replace(/\n/g,'<br>')}</p>`).join('');
    box.innerHTML = html || '<p>(empty)</p>';
  }

  // Load order: #b64h (HTML) -> #html (HTML) -> #text (plain)
  const b64h = fromHash('b64h');
  const hHtml = fromHash('html');
  const qText = fromQuery('text');

  if (b64h) {
    const raw = b64UrlToText(b64h);
    if (raw != null) setHTML(raw);
  } else if (hHtml) {
    setHTML(safeDecode(hHtml));
  } else if (qText) {
    const t = safeDecode(qText).replace(/\\n/g, '\n').replace(/\r\n/g, '\n');
    setTextAsHtml(t);
  }

  // Copy rich HTML
  document.getElementById('copyRich').addEventListener('click', async () => {
    try {
      // Prefer Clipboard API with text/html payload
      const html = box.innerHTML;
      if (navigator.clipboard && window.ClipboardItem) {
        const blob = new Blob([html], { type: 'text/html' });
        await navigator.clipboard.write([new ClipboardItem({ 'text/html': blob, 'text/plain': new Blob([box.innerText], {type:'text/plain'}) })]);
      } else {
        // Fallback: select content and execCommand
        const range = document.createRange();
        range.selectNodeContents(box);
        const sel = window.getSelection();
        sel.removeAllRanges(); sel.addRange(range);
        document.execCommand('copy');
        sel.removeAllRanges();
      }
      status.textContent = 'Copied!';
      setTimeout(()=> status.textContent='', 1800);
    } catch(e){
      status.textContent = 'Copy failed. Select all and press Ctrl/Cmd + C.';
    }
  });

  // Copy plain text
  document.getElementById('copyPlain').addEventListener('click', async () => {
    try{
      const txt = box.innerText;
      if (navigator.clipboard?.writeText) { await navigator.clipboard.writeText(txt); }
      else {
        const tmp = document.createElement('textarea');
        tmp.value = txt; document.body.appendChild(tmp);
        tmp.select(); document.execCommand('copy'); document.body.removeChild(tmp);
      }
      status.textContent = 'Copied!';
      setTimeout(()=> status.textContent='', 1800);
    } catch(e){
      status.textContent = 'Copy failed.';
    }
  });
})();
</script>
</body>
</html>
